<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>308 è‹±é›„æˆ°åŠ›åˆ†æç³»çµ± V4.8</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #22d3ee; --gold: #fbbf24; --math: #10b981; --up: #4ade80; --down: #f87171; --xp: #8b5cf6; }
        body { background: var(--bg); color: #f8fafc; font-family: -apple-system, "Microsoft JhengHei", sans-serif; margin: 0; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 95%; max-width: 600px; padding: 20px; }
        
        /* ç™»å…¥ UI */
        .login-box { background: var(--card); padding: 40px 20px; border-radius: 28px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1); }
        select, input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 2px solid #334155; background: #0f172a; color: white; box-sizing: border-box; font-size: 1rem; }
        .main-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #0ea5e9, #22d3ee); border: none; border-radius: 12px; color: #0f172a; font-size: 1.1rem; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .sub-btn { background: none; border: 1px solid #475569; color: #94a3b8; padding: 10px; border-radius: 8px; cursor: pointer; margin-top: 15px; width: 100%; }

        /* å ±è¡¨å€åŸŸ */
        #reportSection { display: none; background: var(--card); border-radius: 28px; overflow: hidden; animation: fadeIn 0.6s ease; margin-bottom: 50px; border: 1px solid rgba(255,255,255,0.1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .header { background: #1e293b; padding: 25px; text-align: center; border-bottom: 4px solid var(--accent); }
        .rank-orb { width: 60px; height: 60px; border: 3px solid var(--accent); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; background: rgba(0,0,0,0.2); }
        
        .score-display { display: grid; grid-template-columns: 1fr 1fr; background: #0f172a; padding: 15px; text-align: center; border-bottom: 1px solid #334155; }
        .score-box b { display: block; font-size: 1.6rem; color: var(--gold); margin-top: 5px; }

        /* ä¸‰é …æ’å */
        .rank-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; background: rgba(0,0,0,0.3); padding: 15px; gap: 5px; text-align: center; }
        .rank-item small { color: var(--accent); font-size: 0.7rem; display: block; margin-bottom: 3px; }
        .rank-item span { font-size: 0.9rem; font-weight: bold; }

        /* é€²åº¦æ¢ */
        .xp-container { background: #1e293b; padding: 15px 20px; border-top: 1px solid rgba(255,255,255,0.05); }
        .xp-header { display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 8px; }
        .xp-bar-bg { height: 12px; background: #0f172a; border-radius: 6px; overflow: hidden; position: relative; }
        .xp-bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--xp)); width: 0%; transition: 1.2s; }

        .content { padding: 20px; }
        .chart-container { height: 250px; margin-bottom: 20px; }
        
        /* è¼¸å…¥é¢æ¿ */
        .input-panel { background: rgba(0,0,0,0.2); padding: 20px; border-radius: 20px; border: 1px dashed var(--accent); margin-top: 20px; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        
        /* åˆ†æçµæœæ¨£å¼ */
        .evo-card { background: #0f172a; border-radius: 15px; padding: 15px; margin-top: 20px; border-left: 4px solid var(--gold); display: none; }
        .evo-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9rem; }
        .tag { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; margin-left: 5px; }
        .tag-up { background: var(--up); color: #064e3b; }
        .tag-down { background: var(--down); color: #450a0a; }

        .strategy-item { padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid var(--accent); margin-bottom: 8px; border-radius: 0 8px 8px 0; font-size: 0.85rem; line-height: 1.5; }

        /* å½ˆçª— */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; background: #1e293b; border-radius: 20px; padding: 25px; z-index: 1000; border: 1px solid var(--accent); box-shadow: 0 0 50px #000; }
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 999; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginWrapper" class="login-box">
        <div style="font-size: 50px;">ğŸ›¡ï¸</div>
        <h1>308 è‹±é›„æˆ°åŠ›ç³»çµ±</h1>
        <p style="color:#94a3b8; font-size: 0.8rem;">V4.8 æ——è‰¦çµ‚æ¥µç‰ˆ</p>
        <select id="userSelect"><option value="">-- è«‹é¸æ“‡è‹±é›„ --</option></select>
        <input type="password" id="userPass" placeholder="è¼¸å…¥å¯†ç¢¼ (308+åº§è™Ÿ)">
        <button class="main-btn" onclick="handleLogin()">è§£é–æˆ°åŠ›æ•¸æ“š</button>
        <button class="sub-btn" onclick="openPwdModal()">ä¿®æ”¹å€‹äººå¯†ç¢¼</button>
    </div>

    <div id="reportSection">
        <div class="header">
            <div class="rank-orb" id="rankOrb">--</div>
            <h2 id="displayName" style="margin:0">--</h2>
            <div id="predictSchool" style="color:var(--accent); font-size:1rem; margin-top:5px; font-weight:bold">--</div>
        </div>

        <div class="score-display">
            <div class="score-box"><small>ç›®å‰ç­‰ç´šé»æ•¸</small><b id="displayScore">--</b></div>
            <div class="score-box"><small>ä¸‹ä¸€ç­‰ç´šå·®è·</small><b id="pointsGap" style="color:var(--up)">--</b></div>
        </div>

        <div class="rank-grid">
            <div class="rank-item"><small>ğŸ† ç­ç´šåæ¬¡</small><span id="cRank">--</span></div>
            <div class="rank-item"><small>ğŸ¥ˆ æ ¡å…§åæ¬¡</small><span id="sRank">--</span></div>
            <div class="rank-item"><small>ğŸŒ è€ƒå€åæ¬¡</small><span id="dRank">--</span></div>
        </div>

        <div class="xp-container">
            <div class="xp-header"><span id="nextTierLabel">è¼‰å…¥ä¸­...</span><span id="xpPercentText">0%</span></div>
            <div class="xp-bar-bg"><div id="xpFill" class="xp-bar-fill"></div></div>
        </div>

        <div class="content">
            <div class="chart-container"><canvas id="radarChart"></canvas></div>

            <div style="margin-bottom: 25px;">
                <h4 style="margin:0 0 10px; font-size:0.9rem; color:var(--accent)">â³ å»ºè­°ä¿®ç…‰æ™‚é–“æ¯” (æŒ‰å¼±é …æ¬Šé‡)</h4>
                <div id="timeBar" style="display: flex; height: 12px; border-radius: 6px; overflow: hidden; margin-bottom:5px"></div>
                <div style="display:flex; justify-content:space-between; font-size:0.7rem; color:#94a3b8">
                    <span>ğŸ”´ å¼±é …è£œæ•‘</span><span>ğŸŸ¡ è¡åˆº A ç´š</span><span>ğŸŸ¢ å¼·é …å®ˆå‚™</span>
                </div>
            </div>

            <h3 style="color:var(--accent); font-size:1.1rem">âš”ï¸ æ ¸å¿ƒæˆ°è¡“åˆ†æ</h3>
            <div id="strategyList"></div>

            <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 30px 0;">

            <div class="input-panel">
                <h3 style="margin-top:0; color:var(--gold); font-size:1rem">ğŸ”® æ¨¡æ“¬/æœ€æ–°æˆç¸¾è¼¸å…¥åˆ†æ</h3>
                <div class="grid-inputs" id="simInputs"></div>
                <input type="number" id="inNewDRank" placeholder="è¼¸å…¥æœ€æ–°è€ƒå€åæ¬¡ (é¸å¡«)">
                <button class="main-btn" style="margin-top:10px; background:var(--xp); color:white" onclick="updateEvolution()">åŸ·è¡Œé€²åŒ–æ¯”å°åˆ†æ</button>
            </div>

            <div id="evoReport" class="evo-card">
                <h4 style="margin:0 0 10px; color:var(--gold)">ğŸ“ˆ é€²é€€æ­¥èˆ‡ç­–ç•¥å ±å‘Š</h4>
                <div id="evoList"></div>
                <div id="evoStrategy" style="margin-top:15px"></div>
            </div>

            <button onclick="location.reload()" class="sub-btn" style="width:100%; margin-top:40px; border:none; color:#64748b;">ç™»å‡ºç³»çµ±</button>
        </div>
    </div>

    <div id="overlay" class="overlay" onclick="closePwdModal()"></div>
    <div id="pwdModal" class="modal">
        <h3>ä¿®æ”¹å¯†ç¢¼</h3>
        <input type="password" id="oldPwd" placeholder="ç›®å‰çš„å¯†ç¢¼">
        <input type="password" id="newPwd" placeholder="æ–°å¯†ç¢¼ (è‡³å°‘4ä½)">
        <button class="main-btn" onclick="submitNewPwd()">ç¢ºèªä¿®æ”¹</button>
        <button class="sub-btn" onclick="closePwdModal()">å–æ¶ˆ</button>
    </div>
</div>

<script>
    const db = [
        { id: 1, name: "ç‹æ˜±å¡", write: 4, g: {ch:"B+", en:"B", ma:"B++", sc:"B++", so:"A"}, total: 28, c: 12, s: 227, d: 2065 },
        { id: 2, name: "å³å½¥å‹³", write: 3, g: {ch:"B+", en:"B", ma:"A", sc:"B+", so:"B"}, total: 25, c: 15, s: 299, d: 3006 },
        { id: 3, name: "æè‡´è«­", write: 3, g: {ch:"B", en:"C", ma:"A", sc:"B", so:"B+"}, total: 23, c: 20, s: 351, d: 3751 },
        { id: 4, name: "ææ™‰å®‰", write: 3, g: {ch:"B", en:"C", ma:"B+", sc:"B", so:"B"}, total: 20, c: 25, s: 419, d: 5065 },
        { id: 5, name: "æ²ˆå®å½¥", write: 4, g: {ch:"A+", en:"B", ma:"A+", sc:"B+", so:"A"}, total: 31, c: 10, s: 142, d: 1250 },
        { id: 6, name: "å¼µäºå®—", write: 0, g: {ch:"C", en:"B", ma:"B+", sc:"B", so:"B"}, total: 20, c: 26, s: 427, d: 5326 },
        { id: 7, name: "æ¢æ¾„ç¥", write: 2, g: {ch:"B", en:"C", ma:"C", sc:"B", so:"B"}, total: 18, c: 27, s: 460, d: 6423 },
        { id: 8, name: "é™³å®¥äºˆ", write: 3, g: {ch:"C", en:"C", ma:"C", sc:"C", so:"C"}, total: 15, c: 29, s: 499, d: 7712 },
        { id: 9, name: "é™³ç¥å‘ˆ", write: 4, g: {ch:"A+", en:"A+", ma:"B++", sc:"B++", so:"B++"}, total: 34, c: 7, s: 94, d: 757 },
        { id: 10, name: "é™³ç¿å®", write: 3, g: {ch:"B", en:"B", ma:"B", sc:"B+", so:"B+"}, total: 23, c: 21, s: 354, d: 3800 },
        { id: 11, name: "é»ƒç…’å‡±", write: 3, g: {ch:"B++", en:"B", ma:"B+", sc:"B+", so:"B"}, total: 25, c: 14, s: 297, d: 2988 },
        { id: 12, name: "é»ƒå³»å”¯", write: 4, g: {ch:"A++", en:"B+", ma:"A", sc:"A", so:"A+"}, total: 36, c: 6, s: 67, d: 468 },
        { id: 13, name: "æ¥Šçš“å®‡", write: 1, g: {ch:"B", en:"B", ma:"B+", sc:"B", so:"B++"}, total: 22, c: 22, s: 358, d: 3865 },
        { id: 14, name: "åŠ‰ä¸æ©", write: 1, g: {ch:"B", en:"C", ma:"B", sc:"C", so:"B"}, total: 18, c: 28, s: 463, d: 6492 },
        { id: 15, name: "åŠ‰å®¥æ‰¿", write: 4, g: {ch:"B++", en:"B++", ma:"A", sc:"B++", so:"B++"}, total: 31, c: 11, s: 148, d: 1325 },
        { id: 16, name: "åŠ‰ç…¥é¨°", write: 4, g: {ch:"A++", en:"B++", ma:"A", sc:"A+", so:"A++"}, total: 39, c: 2, s: 40, d: 232 },
        { id: 17, name: "æ´ªæ¹˜èŠ¸", write: 5, g: {ch:"B++", en:"B+", ma:"C", sc:"B+", so:"A+"}, total: 27, c: 13, s: 234, d: 2191 },
        { id: 18, name: "èƒ¡èªå½¤", write: 2, g: {ch:"B", en:"B+", ma:"B++", sc:"B", so:"B"}, total: 25, c: 16, s: 303, d: 3117 },
        { id: 19, name: "å¼µæ™ç¿", write: 3, g: {ch:"B+", en:"B", ma:"B", sc:"B", so:"B+"}, total: 24, c: 17, s: 329, d: 3352 },
        { id: 20, name: "å¼µå‡±è–°", write: 4, g: {ch:"B", en:"B+", ma:"A", sc:"C", so:"B"}, total: 22, c: 23, s: 365, d: 3981 },
        { id: 21, name: "è¨±æ™¶è", write: 3, g: {ch:"B+", en:"C", ma:"B+", sc:"B++", so:"B+"}, total: 24, c: 18, s: 333, d: 3372 },
        { id: 22, name: "é»ƒç­±è", write: 5, g: {ch:"A+", en:"B+", ma:"B++", sc:"A+", so:"A++"}, total: 37, c: 3, s: 54, d: 357 },
        { id: 23, name: "é»ƒå¿ƒæ¸", write: 4, g: {ch:"B++", en:"B+", ma:"A++", sc:"B++", so:"B++"}, total: 32, c: 9, s: 133, d: 1126 },
        { id: 24, name: "ç«¥è‹¥ç‘„", write: 4, g: {ch:"A+", en:"B++", ma:"A", sc:"A", so:"A++"}, total: 37, c: 5, s: 59, d: 393 },
        { id: 25, name: "é»ƒå¯€è¡", write: 3, g: {ch:"C", en:"C", ma:"C", sc:"C", so:"C"}, total: 15, c: 29, s: 499, d: 7712 },
        { id: 26, name: "è©¹æ²›ç’‡", write: 5, g: {ch:"B", en:"B+", ma:"B+", sc:"B", so:"B"}, total: 23, c: 19, s: 339, d: 3502 },
        { id: 27, name: "å»–å©•æ¸", write: 4, g: {ch:"B", en:"B", ma:"B", sc:"B", so:"B"}, total: 20, c: 24, s: 412, d: 4886 },
        { id: 28, name: "åŠ‰èŠ®ç‘œ", write: 4, g: {ch:"A++", en:"B++", ma:"A", sc:"A", so:"A"}, total: 37, c: 4, s: 55, d: 363 },
        { id: 29, name: "æ½˜æ›‰éš", write: 4, g: {ch:"A+", en:"A", ma:"B++", sc:"A", so:"B++"}, total: 33, c: 8, s: 109, d: 908 },
        { id: 30, name: "è¬æ²›ç’‡", write: 5, g: {ch:"A++", en:"A+", ma:"A", sc:"A++", so:"A++"}, total: 41, c: 1, s: 29, d: 99 }
    ];

    const pointMap = {"A++":7,"A+":6,"A":5,"B++":4,"B+":3,"B":2,"C":1};
    const thresholds = [
        { score: 0, name: "è“„å‹¢å¾…ç™¼" }, { score: 14, name: "å„ªè³ªæŠ€è·" }, { score: 22, name: "æºªä¸­/å½°å•†" },
        { score: 26, name: "å½°å·¥/å½°å•†" }, { score: 30, name: "å½°ä¸­/å½°å¥³" }, { score: 35, name: "é ‚å°–ç‰¹å„ª" }
    ];
    const subName = {ch:"åœ‹æ–‡", en:"è‹±æ–‡", ma:"æ•¸å­¸", sc:"è‡ªç„¶", so:"ç¤¾æœƒ"};
    let currentUser = null;

    function handleLogin() {
        const id = document.getElementById('userSelect').value;
        const pass = document.getElementById('userPass').value;
        const saved = localStorage.getItem('pwd_'+id) || ("308"+(id<10?'0'+id:id));
        if(pass === saved) {
            currentUser = db.find(x => x.id == id);
            document.getElementById('loginWrapper').style.display='none';
            initDashboard(currentUser);
        } else alert("å¯†ç¢¼éŒ¯èª¤");
    }

    function initDashboard(s) {
        document.getElementById('reportSection').style.display = 'block';
        document.getElementById('displayName').innerText = s.name;
        renderAll(s.g, s.write, s.total, s.c, s.s, s.d);
        
        // é å¡«è¼¸å…¥å€
        ["Ch","En","Ma","Sc","So"].forEach(k => document.getElementById('in'+k).value = s.g[k.toLowerCase()]);
        document.getElementById('inWrite').value = s.write;
    }

    function renderAll(g, w, total, c, s, d) {
        document.getElementById('displayScore').innerText = total + " pt";
        document.getElementById('cRank').innerText = "ç¬¬ " + c + " å";
        document.getElementById('sRank').innerText = "ç¬¬ " + s + " å";
        document.getElementById('dRank').innerText = "ç¬¬ " + d + " å";

        // è½é»èˆ‡é€²åº¦
        let cur = thresholds.filter(t => t.score <= total).pop() || thresholds[0];
        let nxt = thresholds.find(t => t.score > total) || {score:41, name:"å·”å³°å¢ƒç•Œ"};
        document.getElementById('predictSchool').innerText = "ç›®å‰é ä¼°è½é»ï¼š" + cur.name;
        document.getElementById('nextTierLabel').innerText = "ä¸‹ä¸€ç›®æ¨™ï¼š" + nxt.name;
        document.getElementById('pointsGap').innerText = "é‚„å·® " + (nxt.score - total) + " é»";
        
        const pct = Math.min(100, ((total - cur.score) / (nxt.score - cur.score)) * 100);
        document.getElementById('xpFill').style.width = pct + "%";
        document.getElementById('xpPercentText').innerText = Math.round(pct) + "%";
        document.getElementById('rankOrb').innerText = total >= 30 ? "ğŸ’" : (total >= 25 ? "ğŸŒŸ" : "ğŸ›¡ï¸");

        renderChart(g);
        renderTimeBar(g);
        renderTactics(g, w, total);
    }

    function renderTactics(g, w, total) {
        const list = document.getElementById('strategyList'); list.innerHTML = "";
        const sorted = Object.entries(g).sort((a,b) => pointMap[b[1]] - pointMap[a[1]]);
        const items = [
            `<b>ã€æ ¸å¿ƒå®ˆå‚™ã€‘</b>æ‚¨çš„ ${subName[sorted[0][0]]} (${sorted[0][1]}) å·²é”é«˜æ¨™ï¼Œç¶­æŒæ‰‹æ„Ÿå³å¯ã€‚`,
            `<b>ã€è¡åˆºé—œéµã€‘</b>${subName[sorted[1][0]]} ç›®å‰ ${sorted[1][1]}ï¼Œæ˜¯è·¨å…¥ A ç´šæˆ–å‡é»çš„æœ€çŸ­æ·å¾‘ã€‚`,
            `<b>ã€å¯«ä½œå»ºè­°ã€‘</b>ç›®å‰å¯«ä½œ ${w} ç´šï¼Œå°ç¸½é»æ•¸å½±éŸ¿å·¨å¤§ï¼Œè«‹ç·´ç¿’ä½³å¥æ“´å±•ã€‚`,
            `<b>ã€å¿ƒç†æˆ°è¡“ã€‘</b>ç›®å‰ ${total} é»ï¼Œè·é›¢è½é»é€²éšåƒ…éœ€ ${nxtGap(total)} é»ï¼Œç©©ä½ä¸é€€æ­¥å°±æ˜¯é€²æ­¥ã€‚`
        ];
        items.forEach(t => { const d = document.createElement('div'); d.className="strategy-item"; d.innerHTML=t; list.appendChild(d); });
    }

    function nxtGap(p) { let n = thresholds.find(t => t.score > p); return n ? n.score - p : 1; }

    function updateEvolution() {
        const newG = { ch: document.getElementById('inCh').value, en: document.getElementById('inEn').value, ma: document.getElementById('inMa').value, sc: document.getElementById('inSc').value, so: document.getElementById('inSo').value };
        const newW = parseInt(document.getElementById('inWrite').value);
        const newD = parseInt(document.getElementById('inNewDRank').value) || currentUser.d;
        const newTotal = pointMap[newG.ch] + pointMap[newG.en] + pointMap[newG.ma] + pointMap[newG.sc] + pointMap[newG.so] + newW;

        // æ›´æ–°ä¸Šæ–¹ Dashboard
        renderAll(newG, newW, newTotal, "--", "--", newD);

        // ç”Ÿæˆé€²é€€æ­¥å ±å‘Š
        document.getElementById('evoReport').style.display = 'block';
        const evoList = document.getElementById('evoList'); evoList.innerHTML = "";
        
        Object.keys(newG).forEach(k => {
            const diff = pointMap[newG[k]] - pointMap[currentUser.g[k]];
            const row = document.createElement('div'); row.className = "evo-row";
            const tag = diff > 0 ? `<span class="tag tag-up">é€²æ­¥</span>` : (diff < 0 ? `<span class="tag tag-down">é€€æ­¥</span>` : `<span class="tag">æŒå¹³</span>`);
            row.innerHTML = `<span>${subName[k]} (${currentUser.g[k]} â” ${newG[k]})</span> ${tag}`;
            evoList.appendChild(row);
        });

        const dDiff = currentUser.d - newD;
        const dRow = document.createElement('div'); dRow.className = "evo-row";
        dRow.innerHTML = `<span>è€ƒå€åæ¬¡ (${currentUser.d} â” ${newD})</span> ${dDiff > 0 ? `<span class="tag tag-up">é€²æ­¥ ${dDiff} å</span>` : (dDiff < 0 ? `<span class="tag tag-down">é€€æ­¥ ${Math.abs(dDiff)} å</span>` : `<span class="tag">æŒå¹³</span>`)}`;
        evoList.appendChild(dRow);

        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function renderChart(g) {
        const m = {"A++":100,"A+":90,"A":80,"B++":65,"B+":55,"B":45,"C":20};
        const ctx = document.getElementById('radarChart').getContext('2d');
        if(window.myChart) window.myChart.destroy();
        window.myChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['åœ‹', 'è‹±', 'æ•¸', 'è‡ª', 'ç¤¾'],
                datasets: [{ 
                    data: [m[g.ch], m[g.en], m[g.ma], m[g.sc], m[g.so]],
                    backgroundColor: 'rgba(34, 211, 238, 0.2)', borderColor: '#22d3ee', borderWidth: 2, pointRadius: 2
                }]
            },
            options: { maintainAspectRatio: false, scales: { r: { grid:{color:'rgba(255,255,255,0.1)'}, angleLines:{color:'rgba(255,255,255,0.1)'}, ticks:{display:false}, suggestedMin:0, suggestedMax:100 } }, plugins:{legend:{display:false}} }
        });
    }

    function renderTimeBar(g) {
        const bar = document.getElementById('timeBar'); bar.innerHTML = "";
        const lv = {"A++":1, "A+":1, "A":1, "B++":3, "B+":5, "B":7, "C":10};
        let r=0, y=0, gv=0;
        Object.values(g).forEach(l => {
            if(l.includes("A")) gv += lv[l]; else if(l.includes("B+")) y += lv[l]; else r += lv[l];
        });
        const sum = r+y+gv;
        [[r,"#ef4444"],[y,"#fbbf24"],[gv,"#10b981"]].forEach(t => {
            const d = document.createElement('div'); d.style.width = (t[0]/sum*100) + "%"; d.style.background = t[1]; bar.appendChild(d);
        });
    }

    function openPwdModal() { document.getElementById('overlay').style.display='block'; document.getElementById('pwdModal').style.display='block'; }
    function closePwdModal() { document.getElementById('overlay').style.display='none'; document.getElementById('pwdModal').style.display='none'; }
    function submitNewPwd() {
        const id = document.getElementById('userSelect').value;
        const saved = localStorage.getItem('pwd_'+id) || ("308"+(id<10?'0'+id:id));
        if(document.getElementById('oldPwd').value === saved && document.getElementById('newPwd').value.length >= 4) {
            localStorage.setItem('pwd_'+id, document.getElementById('newPwd').value);
            alert("ä¿®æ”¹æˆåŠŸï¼"); closePwdModal();
        } else alert("é©—è­‰å¤±æ•—");
    }

    window.onload = () => {
        const sel = document.getElementById('userSelect');
        db.forEach(s => { const o = document.createElement('option'); o.value=s.id; o.text=`${s.id < 10 ? '0'+s.id : s.id} - ${s.name}`; sel.appendChild(o); });
        
        const sim = document.getElementById('simInputs');
        ["Ch","En","Ma","Sc","So"].forEach(k => {
            const d = document.createElement('div'); d.innerHTML = `<label style="font-size:0.7rem; color:#94a3b8">${subName[k.toLowerCase()]}</label><select id="in${k}"></select>`;
            sim.appendChild(d);
            ["A++","A+","A","B++","B+","B","C"].forEach(l => { const o = document.createElement('option'); o.value=o.text=l; document.getElementById('in'+k).appendChild(o); });
        });
        const wd = document.createElement('div'); wd.innerHTML = `<label style="font-size:0.7rem; color:#94a3b8">å¯«ä½œ</label><select id="inWrite"></select>`;
        sim.appendChild(wd);
        [6,5,4,3,2,1,0].forEach(v => { const o = document.createElement('option'); o.value=o.text=v; document.getElementById('inWrite').appendChild(o); });
    }
</script>
</body>
</html>