<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>308 è‹±é›„æˆ°åŠ›åˆ†æç³»çµ± V3.3</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #22d3ee; --gold: #fbbf24; --math: #10b981; --science: #f97316; }
        body { background: var(--bg); color: #f8fafc; font-family: -apple-system, "Microsoft JhengHei", sans-serif; margin: 0; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 95%; max-width: 600px; padding: 20px; }
        
        /* åˆå§‹ç™»å…¥é  */
        .login-box { background: var(--card); padding: 50px 30px; border-radius: 28px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1); }
        .hero-icon { font-size: 80px; margin-bottom: 20px; display: inline-block; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        h1 { font-size: 2.5rem; color: var(--accent); margin: 10px 0; }
        select, input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 2px solid #334155; background: #0f172a; color: white; font-size: 1.1rem; box-sizing: border-box; }
        
        .main-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #0ea5e9, #22d3ee); border: none; border-radius: 12px; color: #0f172a; font-size: 1.3rem; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .main-btn:hover { transform: scale(1.02); filter: brightness(1.1); }
        .sub-btn { background: none; border: 1px solid #475569; color: #94a3b8; padding: 10px; border-radius: 8px; cursor: pointer; margin-top: 15px; width: 100%; }

        /* å ±è¡¨å€ */
        #reportSection { display: none; background: var(--card); border-radius: 28px; overflow: hidden; animation: fadeIn 0.8s ease; margin-bottom: 50px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .header { background: #1e293b; padding: 30px; text-align: center; border-bottom: 4px solid var(--accent); }
        .rank-orb { width: 80px; height: 80px; border: 3px solid var(--accent); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; background: rgba(0,0,0,0.2); }
        
        /* æ ¸å¿ƒæ•¸æ“šé¡¯ç¤ºå€ */
        .score-display { display: grid; grid-template-columns: 1fr 1fr; background: #0f172a; padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .score-box b { display: block; font-size: 2.2rem; color: var(--gold); }
        
        /* æ’åæ•¸æ“šå€ */
        .rank-display { display: grid; grid-template-columns: 1fr 1fr 1fr; background: rgba(0,0,0,0.3); padding: 15px 5px; text-align: center; gap: 5px; }
        .rank-item { border-right: 1px solid rgba(255,255,255,0.1); }
        .rank-item:last-child { border-right: none; }
        .rank-item small { color: var(--accent); font-size: 0.75rem; display: block; margin-bottom: 5px; }
        .rank-item span { font-size: 1.2rem; font-weight: 800; color: #fff; }

        .content { padding: 25px; }
        .chart-container { height: 280px; margin-bottom: 30px; background: rgba(255,255,255,0.02); border-radius: 20px; padding: 10px; }
        
        .strategy-item { padding: 12px; background: rgba(255,255,255,0.03); border-left: 4px solid var(--accent); margin-bottom: 10px; border-radius: 0 8px 8px 0; font-size: 0.95rem; }

        .res-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 15px; }
        .res-card { text-decoration: none; color: white; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; background: rgba(255,255,255,0.05); transition: 0.3s; }
        .res-card:hover { transform: translateX(5px); background: rgba(255,255,255,0.1); }
        .res-icon { font-size: 1.5rem; margin-right: 12px; }

        /* è¼¸å…¥å€ */
        .input-card { background: rgba(0,0,0,0.2); padding: 20px; border-radius: 20px; margin-top: 30px; border: 1px dashed var(--accent); }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .input-card label { font-size: 0.8rem; color: var(--accent); display: block; margin-top: 5px; }

        /* é€²åº¦æ¢ */
        .xp-section { margin-top: 25px; }
        .xp-bar { height: 12px; background: #334155; border-radius: 6px; overflow: hidden; margin: 10px 0; }
        .xp-fill { height: 100%; background: var(--accent); width: 0%; transition: 1.5s; }

        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; background: #1e293b; border-radius: 20px; padding: 30px; z-index: 1000; border: 1px solid var(--accent); box-shadow: 0 0 50px #000; }
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 999; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginWrapper" class="login-box">
        <div class="hero-icon">ğŸ›¡ï¸</div>
        <h1>308 è‹±é›„æˆ°åŠ›</h1>
        <p>11æœˆæ¨¡æ“¬è€ƒæ•¸æ“šåˆ†æç³»çµ±</p>
        <select id="userSelect"><option value="">-- è«‹é¸æ“‡å­¸ç”Ÿå§“å --</option></select>
        <input type="password" id="userPass" placeholder="è«‹è¼¸å…¥å¯†ç¢¼ (é è¨­308+åº§è™Ÿ)">
        <button class="main-btn" onclick="handleLogin()">é€²å…¥æˆ°åŠ›ä¸­å¿ƒ</button>
        <button class="sub-btn" onclick="openPwdModal()">ä¿®æ”¹å¯†ç¢¼</button>
    </div>

    <div id="reportSection">
        <div class="header">
            <div class="rank-orb" id="rankOrb">--</div>
            <h2 id="displayName" style="margin:5px 0">--</h2>
            <div id="displayRank" style="color:var(--gold)">--</div>
        </div>

        <div class="score-display">
            <div class="score-box"><small>ç›®å‰ç¸½ç©åˆ†</small><b id="displayScore">--</b></div>
            <div class="score-box"><small>é ä¼°è½é»</small><b id="predictSchool" style="font-size:1.2rem; margin-top:10px">--</b></div>
        </div>

        <div class="rank-display">
            <div class="rank-item"><small>ğŸ† ç­ç´šæ’å</small><span id="displayCRank">--</span></div>
            <div class="rank-item"><small>ğŸ¥ˆ å…¨æ ¡æ’å</small><span id="displaySRank">--</span></div>
            <div class="rank-item"><small>ğŸŒ è€ƒå€æ’å</small><span id="displayDRank">--</span></div>
        </div>

        <div class="content">
            <div class="chart-container"><canvas id="radarChart"></canvas></div>

            <h3 style="color:var(--accent)">ğŸ›¡ï¸ æˆ°è¡“åˆ†æå»ºè­°</h3>
            <div id="strategyList"></div>

            <h3 style="color:var(--gold); margin-top:25px">ğŸ’ è‹±é›„è£œçµ¦ç«™</h3>
            <div class="res-grid" id="resourceLinks"></div>

            <div class="xp-section">
                <div style="display:flex; justify-content:space-between">
                    <span id="nextLevelGoal" style="color:var(--accent); font-weight:bold">--</span>
                    <span id="scoreGap" style="color:var(--gold)">--</span>
                </div>
                <div class="xp-bar"><div id="xpFill" class="xp-fill"></div></div>
                <p id="levelHint" style="font-size:0.8rem; color:#94a3b8; text-align:center"></p>
            </div>

            <div class="input-card">
                <h4 style="margin-top:0; color:var(--accent)">ğŸ”® æœ€æ–°æˆ°åŠ›åˆ†æå™¨</h4>
                <p style="font-size:0.8rem; opacity:0.8">è«‹è¼¸å…¥ã€Œæœ€æ–°ä¸€æ¬¡æˆç¸¾ã€ï¼Œç³»çµ±å°‡ç«‹å³é‡æ–°è¨ˆç®—æˆ°åŠ›ï¼</p>
                <div class="grid-inputs">
                    <div><label>åœ‹æ–‡</label><select id="inCh"><option value="A++">A++</option><option value="A+">A+</option><option value="A">A</option><option value="B++">B++</option><option value="B+">B+</option><option value="B">B</option><option value="C">C</option></select></div>
                    <div><label>è‹±æ–‡</label><select id="inEn"><option value="A++">A++</option><option value="A+">A+</option><option value="A">A</option><option value="B++">B++</option><option value="B+">B+</option><option value="B">B</option><option value="C">C</option></select></div>
                    <div><label>æ•¸å­¸</label><select id="inMa"><option value="A++">A++</option><option value="A+">A+</option><option value="A">A</option><option value="B++">B++</option><option value="B+">B+</option><option value="B">B</option><option value="C">C</option></select></div>
                    <div><label>è‡ªç„¶</label><select id="inSc"><option value="A++">A++</option><option value="A+">A+</option><option value="A">A</option><option value="B++">B++</option><option value="B+">B+</option><option value="B">B</option><option value="C">C</option></select></div>
                    <div><label>ç¤¾æœƒ</label><select id="inSo"><option value="A++">A++</option><option value="A+">A+</option><option value="A">A</option><option value="B++">B++</option><option value="B+">B+</option><option value="B">B</option><option value="C">C</option></select></div>
                    <div><label>ä½œæ–‡ç´šåˆ†</label><select id="inWrite"><option value="6">6</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select></div>
                </div>
                <div class="grid-inputs" style="margin-top:10px">
                    <div><label>ç­æ’</label><input type="number" id="inCRank" placeholder="æœ€æ–°ç­æ’"></div>
                    <div><label>æ ¡æ’</label><input type="number" id="inSRank" placeholder="æœ€æ–°æ ¡æ’"></div>
                </div>
                <button class="main-btn" style="margin-top:15px; font-size:1rem; padding:12px" onclick="updateNewAnalysis()">æ›´æ–°æœ€æ–°æˆ°åŠ›åˆ†æ</button>
            </div>

            <button onclick="location.reload()" class="sub-btn">ç™»å‡ºç³»çµ±</button>
        </div>
    </div>

    <div id="overlay" class="overlay" onclick="closePwdModal()"></div>
    <div id="pwdModal" class="modal">
        <h3>ä¿®æ”¹å€‹äººå¯†ç¢¼</h3>
        <input type="password" id="oldPwd" placeholder="ç›®å‰çš„å¯†ç¢¼">
        <input type="password" id="newPwd" placeholder="æ–°å¯†ç¢¼ (è‡³å°‘4ä½)">
        <button class="main-btn" onclick="submitNewPwd()">ç¢ºèªä¿®æ”¹</button>
        <button class="sub-btn" onclick="closePwdModal()">å–æ¶ˆ</button>
    </div>
</div>

<script>
    // åŸå§‹è³‡æ–™åº« (åŒ…å«æ’å)
    const studentDB = [
        { id: 1, name: "ç‹æ˜±å¡", rank: "æ¦®è€€æ˜Ÿè¾°", score: 28, cRank: 12, sRank: 227, dRank: 2065, grades: {ch:"B+", en:"B", ma:"B++", sc:"B++", so:"A"}, s: ["ç¤¾æœƒç§‘ A ç´šè¡¨ç¾å„ªç•°ï¼Œå»ºè­°ç¶­æŒé¡Œæ„Ÿã€‚","æ•¸ç†é›™ B++ æ˜¯æˆ°åŠ›æ ¸å¿ƒã€‚","åœ‹æ–‡ B+ éœ€å¤šç·´ç¿’æ–‡è¨€æ–‡ã€‚"] },
        { id: 2, name: "å³å½¥å‹³", rank: "ä¸å±ˆé’éŠ…", score: 25, cRank: 15, sRank: 299, dRank: 3006, grades: {ch:"B+", en:"B", ma:"A", sc:"B++", so:"B"}, s: ["æ•¸å­¸ A ç´šè¡¨ç¾æ¥µç‚ºå‡ºè‰²ã€‚","è‡ªç„¶ç§‘ B++ åº•å­ç´®å¯¦ã€‚"] },
        { id: 3, name: "æè‡´è«­", rank: "ä¸å±ˆé’éŠ…", score: 23, cRank: 20, sRank: 351, dRank: 3751, grades: {ch:"B", en:"C", ma:"A", sc:"B", so:"B+"}, s: ["æ•¸å­¸ A ç´šæˆ°åŠ›é©šäººã€‚","åªè¦è‹±æ–‡æˆåŠŸè„« Cï¼Œåæ¬¡å°‡å¤§å¹…æˆé•·ã€‚"] },
        { id: 4, name: "ææ™‰å®‰", rank: "å¾…è¦ºé†’", score: 20, cRank: 25, sRank: 419, dRank: 5065, grades: {ch:"B", en:"C", ma:"B+", sc:"B", so:"B"}, s: ["æ•¸å­¸ B+ å±•ç¾å‡ºè‰¯å¥½çš„é‚è¼¯æ½›åŠ›ã€‚","å»ºè­°å„ªå…ˆæ‹¯æ•‘è‹±æ–‡ç§‘ã€‚"] },
        { id: 5, name: "æ²ˆå®å½¥", rank: "æ¦®è€€æ˜Ÿè¾°", score: 31, cRank: 10, sRank: 142, dRank: 1250, grades: {ch:"A", en:"B", ma:"A", sc:"B++", so:"A"}, s: ["åœ‹ã€æ•¸ã€ç¤¾ä¸‰ A é”æˆï¼","ç©©å±…å…¨ç­å‰ 10 åï¼Œå½°ä¸­æ©Ÿæœƒå¤§ã€‚"] },
        { id: 6, name: "å¼µäºå®—", rank: "å¾…è¦ºé†’", score: 20, cRank: 26, sRank: 427, dRank: 5326, grades: {ch:"C", en:"B", ma:"B+", sc:"B", so:"B"}, s: ["æ•¸å­¸ B+ èˆ‡è‹±æ–‡ B æ˜¯æ ¸å¿ƒé˜²ç·šã€‚","åœ‹æ–‡æ‰å…¥ C ç´šæ˜¯è­¦è¨Šã€‚"] },
        { id: 7, name: "æ¢æ¾„ç¥", rank: "å¾…è¦ºé†’", score: 18, cRank: 27, sRank: 460, dRank: 6423, grades: {ch:"B", en:"C", ma:"C", sc:"B", so:"B"}, s: ["åœ‹ã€è‡ªã€ç¤¾ç¶­æŒ B ç´šåŸºæœ¬ç›¤ã€‚","æ•¸å­¸èˆ‡è‹±æ–‡éœ€å„ªå…ˆè£œå¼·ã€‚"] },
        { id: 8, name: "é™³å®¥äºˆ", rank: "å¾…è¦ºé†’", score: 12, cRank: 29, sRank: 499, dRank: 7712, grades: {ch:"C", en:"C", ma:"C", sc:"C", so:"C"}, s: ["ç›®å‰è™•æ–¼ä½è°·æœŸï¼Œé‡æ–°ç›¤é»è³‡æºã€‚","è€å¸«æœƒé™ªä½ ä¸€èµ·åŠªåŠ›ã€‚"] },
        { id: 9, name: "é™³ç¥å‘ˆ", rank: "æ¦®è€€æ˜Ÿè¾°", score: 34, cRank: 7, sRank: 94, dRank: 757, grades: {ch:"A", en:"A", ma:"B++", sc:"B++", so:"A"}, s: ["åœ‹ã€è‹±ã€ç¤¾ä¸‰ A ç‹è€…ã€‚","æ ¡æ’é€²å…¥å‰ 100 å¼·ï¼"] },
        { id: 10, name: "é™³ç¿å®", rank: "ä¸å±ˆé’éŠ…", score: 23, cRank: 21, sRank: 354, dRank: 3800, grades: {ch:"B", en:"B", ma:"B", sc:"B", so:"B"}, s: ["å…¨ç§‘çš† Bï¼è¡¨ç¾æ¥µåº¦å‡è¡¡ã€‚","å»ºè­°é¸å®šç¤¾æœƒç§‘å…ˆè¡Œè¡åˆºè®Š Aã€‚"] },
        { id: 11, name: "æ•ç…’å‡±", rank: "ä¸å±ˆé’éŠ…", score: 25, cRank: 14, sRank: 297, dRank: 2988, grades: {ch:"B++", en:"B", ma:"B+", sc:"B+", so:"B"}, s: ["åœ‹æ–‡è¡ä¸Š B++ï¼Œèªæ–‡æ„Ÿæå‡ã€‚","æ•´é«”åæ¬¡ç©©æ­¥ä¸Šæšã€‚"] },
        { id: 12, name: "é»ƒå³»å”¯", rank: "ç’€ç’¨å‚³èªª", score: 36, cRank: 6, sRank: 67, dRank: 468, grades: {ch:"A++", en:"B+", ma:"A", sc:"A", so:"A"}, s: ["åœ‹æ–‡ A++ å°é ‚ï¼","ç›®æ¨™æ˜ç¢ºé–å®šå½°ä¸­ã€‚"] },
        { id: 13, name: "æ¥Šçš“å®‡", rank: "ä¸å±ˆé’éŠ…", score: 22, cRank: 22, sRank: 358, dRank: 3865, grades: {ch:"B", en:"B", ma:"B+", sc:"B", so:"B++"}, s: ["ç¤¾æœƒ B++ æ˜¯ç›®å‰å¾—åˆ†é›™ç®­é ­ã€‚","ç¶­æŒè®€æ›¸ç¯€å¥ã€‚"] },
        { id: 14, name: "åŠ‰ä¸æ©", rank: "å¾…è¦ºé†’", score: 18, cRank: 28, sRank: 463, dRank: 6492, grades: {ch:"B", en:"C", ma:"B", sc:"C", so:"B"}, s: ["åœ‹ã€æ•¸ã€ç¤¾ä¸‰ç§‘å®ˆä½ B ç´šé˜²ç·šã€‚","ä¸å¯å®Œå…¨æ”¾æ£„è‹±æ–‡ã€‚"] },
        { id: 15, name: "åŠ‰å®¥æ‰¿", rank: "æ¦®è€€æ˜Ÿè¾°", score: 31, cRank: 11, sRank: 148, dRank: 1325, grades: {ch:"B++", en:"B++", ma:"A", sc:"B++", so:"A"}, s: ["æ•¸å­¸èˆ‡ç¤¾æœƒé›™ A é”æˆã€‚","å¯¦åŠ›å·²éå¸¸æ¥è¿‘å“¡ä¸­ã€å½°ä¸­é–€æª»ã€‚"] },
        { id: 16, name: "åŠ‰ç…¥é¨°", rank: "ç’€ç’¨å‚³èªª", score: 39, cRank: 2, sRank: 40, dRank: 232, grades: {ch:"A++", en:"B++", ma:"A", sc:"A++", so:"A++"}, s: ["ä¸‰ç§‘ A++ ç‹è€…å¯¦åŠ›ï¼","å½°ä¸­éŒ„å–è³‡æ ¼æ¥µåº¦ç©©å®šã€‚"] },
        { id: 17, name: "æ´ªæ¹˜èŠ¸", rank: "ä¸å±ˆé’éŠ…", score: 27, cRank: 13, sRank: 234, dRank: 2191, grades: {ch:"B++", en:"B+", ma:"C", sc:"B+", so:"A+"}, s: ["ç¤¾æœƒ A+ é©šè‰·å…¨å ´ï¼","æ•‘èµ·æ•¸å­¸ï¼Œåæ¬¡å°‡æœƒé£›èºã€‚"] },
        { id: 18, name: "èƒ¡èªå½¤", rank: "ä¸å±ˆé’éŠ…", score: 25, cRank: 16, sRank: 303, dRank: 3117, grades: {ch:"B", en:"B++", ma:"B++", sc:"B", so:"B"}, s: ["è‹±æ–‡èˆ‡æ•¸å­¸é›™ B++ï¼Œç†è§£åŠ›ä½³ã€‚","ç›®æ¨™æ”»å…‹ç¬¬ä¸€å€‹ Aã€‚"] },
        { id: 19, name: "å¼µæ™ç¿", rank: "å¾…è¦ºé†’", score: 24, cRank: 17, sRank: 329, dRank: 3352, grades: {ch:"B+", en:"B", ma:"B", sc:"B", so:"B+"}, s: ["æ–‡ç§‘å¯¦åŠ›å…·å‚™åŸºæœ¬ç›¤ã€‚","æˆ°åŠ›æ­£åœ¨ç©©æ­¥å›å‡ä¸­ã€‚"] },
        { id: 20, name: "å¼µå‡±è–°", rank: "ä¸å±ˆé’éŠ…", score: 22, cRank: 23, sRank: 365, dRank: 3981, grades: {ch:"B", en:"B+", ma:"B", sc:"C", so:"B"}, s: ["è‹±æ–‡ B+ è¡¨ç¾æœ€çªå‡ºã€‚","å»ºè­°é‡æ–°è¤‡ç¿’è‡ªç„¶åŸºç¤ã€‚"] },
        { id: 21, name: "è¨±æ™¶è", rank: "å¾…è¦ºé†’", score: 24, cRank: 18, sRank: 333, dRank: 3372, grades: {ch:"B+", en:"C", ma:"B+", sc:"B++", so:"B"}, s: ["è‡ªç„¶ B++ å±•ç¾æ¥µä½³ç†ç§‘æ½›åŠ›ã€‚","è‹±æ–‡å› B æ’åå°‡å¤§é€²ã€‚"] },
        { id: 22, name: "èŒ¹ç­±è", rank: "ç’€ç’¨å‚³èªª", score: 37, cRank: 3, sRank: 23, dRank: 357, grades: {ch:"A+", en:"B+", ma:"B++", sc:"A++", so:"A++"}, s: ["ç†ç¤¾é›™ A++ï¼åˆ¶éœ¸å…¨å ´ã€‚","ç›®æ¨™æ˜ç¢ºé–å®šå½°å¥³ã€‚"] },
        { id: 23, name: "èŒ¹å¿ƒæ¸", rank: "æ¦®è€€æ˜Ÿè¾°", score: 32, cRank: 9, sRank: 66, dRank: 1126, grades: {ch:"B++", en:"B++", ma:"A++", sc:"B++", so:"A"}, s: ["æ•¸å­¸ A++ å°é ‚ï¼é‚è¼¯å¼·æ‚ã€‚","å½°ä¸­å½°å¥³å¯¦åŠ›ä¿è­‰ã€‚"] },
        { id: 24, name: "ç«¥è‹¥ç‘„", rank: "ç’€ç’¨å‚³èªª", score: 37, cRank: 5, sRank: 27, dRank: 393, grades: {ch:"A", en:"B++", ma:"A", sc:"A", so:"A"}, s: ["å››ç§‘çš† A å…¨æ‰é¸æ‰‹ï¼","å¯¦åŠ›ç©©å®šå‹ä»»å½°å¥³ã€‚"] },
        { id: 25, name: "é»ƒç´«è¡", rank: "å¾…è¦ºé†’", score: 15, cRank: 30, sRank: 499, dRank: 7712, grades: {ch:"C", en:"C", ma:"C", sc:"C", so:"C"}, s: ["æˆ°åŠ›æ½›ä¼æœŸï¼Œå…ˆæ±‚çªç ´ä¸€ç§‘ã€‚"] },
        { id: 26, name: "è©¹æ²›ç’‡", rank: "ä¸å±ˆé’éŠ…", score: 23, cRank: 19, sRank: 339, dRank: 3502, grades: {ch:"B", en:"B+", ma:"B", sc:"B", so:"B"}, s: ["å…¨ç§‘çš† Bï¼Œä¸­å …åŠ›é‡ç©©å®šã€‚"] },
        { id: 27, name: "å»–å©•æ¸", rank: "å¾…è¦ºé†’", score: 16, cRank: 20, sRank: 412, dRank: 4886, grades: {ch:"B", en:"B", ma:"C", sc:"B", so:"C"}, s: ["åœ‹è‹±è‡ªå®ˆä½ B ç´šé˜²ç¦¦ã€‚"] },
        { id: 28, name: "åŠ‰èŠ®ç‘œ", rank: "ç’€ç’¨å‚³èªª", score: 37, cRank: 4, sRank: 24, dRank: 363, grades: {ch:"A++", en:"B++", ma:"A", sc:"A", so:"A"}, s: ["åœ‹æ–‡ A++ å°é ‚ï¼ä¸‰å† ç‹å¯¦åŠ›ã€‚"] },
        { id: 29, name: "æ½˜æ›‰éš", rank: "æ¦®è€€æ˜Ÿè¾°", score: 33, cRank: 8, sRank: 109, dRank: 908, grades: {ch:"A+", en:"B++", ma:"B++", sc:"B++", so:"B++"}, s: ["åœ‹æ–‡ A+ é ˜è»ï¼Œæ–‡ç†å‡è¡¡ã€‚"] },
        { id: 30, name: "è¬æ²›ç’‡", rank: "è‡³å°Šå‚³èªª", score: 41, cRank: 1, sRank: 11, dRank: 99, grades: {ch:"A++", en:"A", ma:"A", sc:"A++", so:"A++"}, s: ["308 æœ€å¼·å‚³èªªï¼æ ¡æ’ç¬¬ 11 åã€‚"] }
    ];

    const thresholds = [
        { score: 104, name: "å„ªè³ªæŠ€è·é–€æª»" },
        { score: 109, name: "å“¡å®¶å®¶æ”¿/åŒ—å®¶å•†ç¶“" },
        { score: 112, name: "æºªæ¹–é«˜ä¸­/å½°å•†å•†ç¶“" },
        { score: 116, name: "å½°å·¥é›»æ©Ÿ/å½°å•†æ‡‰å¤–" },
        { score: 120, name: "å½°ä¸­/å½°å¥³" }
    ];

    window.onload = () => {
        const sel = document.getElementById('userSelect');
        studentDB.forEach(s => {
            const opt = document.createElement('option');
            opt.value = s.id;
            opt.textContent = `${s.id < 10 ? '0'+s.id : s.id} - ${s.name}`;
            sel.appendChild(opt);
        });
    };

    function handleLogin() {
        const id = document.getElementById('userSelect').value;
        const pass = document.getElementById('userPass').value;
        const correct = localStorage.getItem('pwd_'+id) || "308"+(id < 10 ? '0'+id : id);
        if(!id) return alert("è«‹é¸æ“‡å§“å");
        if(pass === correct) {
            document.getElementById('loginWrapper').style.display='none';
            showReport(id);
        } else alert("å¯†ç¢¼éŒ¯èª¤");
    }

    function showReport(id) {
        const s = studentDB.find(x => x.id == id);
        const total = 90 + s.score;
        document.getElementById('reportSection').style.display = 'block';
        document.getElementById('displayName').innerText = s.name;
        document.getElementById('displayScore').innerText = total;
        document.getElementById('displayRank').innerText = s.rank;
        document.getElementById('displayCRank').innerText = s.cRank;
        document.getElementById('displaySRank').innerText = s.sRank;
        document.getElementById('displayDRank').innerText = s.dRank;
        document.getElementById('rankOrb').innerText = ({"è‡³å°Š":"ğŸ‘‘","ç’€ç’¨":"ğŸ’","æ¦®è€€":"ğŸŒŸ","ä¸å±ˆ":"ğŸ›¡ï¸","å¾…è¦º":"ğŸ”¥"})[s.rank.substring(0,2)];

        updateVisuals(total, s.grades, s.s);
    }

    function updateVisuals(total, grades, strategies) {
        let pSchool = "å†æ¥å†å²";
        for(let i=thresholds.length-1; i>=0; i--) { if(total >= thresholds[i].score) { pSchool = thresholds[i].name; break; } }
        document.getElementById('predictSchool').innerText = pSchool;

        const list = document.getElementById('strategyList');
        list.innerHTML = "";
        strategies.forEach(txt => {
            const d = document.createElement('div');
            d.className = "strategy-item";
            d.innerText = txt;
            list.appendChild(d);
        });

        const resDiv = document.getElementById('resourceLinks');
        resDiv.innerHTML = `
            <a class="res-card" href="https://www.junyiacademy.org/course-compare/chinese-literacy" target="_blank">
                <span class="res-icon">ğŸ“–</span><div><b>åœ‹æ–‡é–±è®€å¼·åŒ–</b><br><small>ç²¾æº–æ‹†è§£ç™½è©±èˆ‡æ–‡è¨€æ–‡</small></div>
            </a>
            <a class="res-card" href="https://www.junyiacademy.org/junyi-math/j-math" target="_blank" style="border-left: 4px solid var(--math)">
                <span class="res-icon">ğŸ“</span><div><b>æ•¸å­¸è‹±é›„ä¿®ç…‰</b><br><small>åœ‹ä¸­æ•¸å­¸å…¨å–®å…ƒåŸºç¤èˆ‡é€²éš</small></div>
            </a>
            <a class="res-card" href="https://www.junyiacademy.org/junyi-science" target="_blank" style="border-left: 4px solid var(--science)">
                <span class="res-icon">ğŸ§ª</span><div><b>ç†åŒ–è‡ªç„¶ä¹‹æº</b><br><small>åœ–è§£ç†åŒ–å¯¦é©—èˆ‡ç§‘å­¸åŸç†</small></div>
            </a>
        `;

        const next = thresholds.find(t => t.score > total) || {score:125, name:"å…¨ç¸£å·”å³°"};
        const gap = next.score - total;
        document.getElementById('nextLevelGoal').innerText = `ä¸‹ä¸€ç›®æ¨™ï¼š${next.name}`;
        document.getElementById('scoreGap').innerText = `å·®è· ${gap} åˆ†`;
        document.getElementById('levelHint').innerText = `æŒçºŒä¿æŒç¯€å¥ï¼Œä½ è·é›¢ç›®æ¨™å­¸æ ¡åƒ…å‰© ${gap} åˆ†ï¼`;
        const prog = ((total - 90) / 35) * 100;
        document.getElementById('xpFill').style.width = Math.min(100, prog) + "%";

        renderChart(grades);
    }

    function updateNewAnalysis() {
        const g = {
            ch: document.getElementById('inCh').value,
            en: document.getElementById('inEn').value,
            ma: document.getElementById('inMa').value,
            sc: document.getElementById('inSc').value,
            so: document.getElementById('inSo').value
        };
        const write = parseInt(document.getElementById('inWrite').value);
        const cRank = document.getElementById('inCRank').value;
        const sRank = document.getElementById('inSRank').value;

        const v = {"A++":7,"A+":6,"A":5,"B++":4,"B+":3,"B":2,"C":1};
        const newScore = v[g.ch]+v[g.en]+v[g.ma]+v[g.sc]+v[g.so] + write;
        const newTotal = 90 + newScore;
        
        // å³æ™‚æ›´æ–°ä»‹é¢ä¸Šçš„æ’åèˆ‡åˆ†æ•¸
        document.getElementById('displayScore').innerText = newTotal;
        if(cRank) document.getElementById('displayCRank').innerText = cRank;
        if(sRank) document.getElementById('displaySRank').innerText = sRank;
        document.getElementById('displayDRank').innerText = "--"; // æ¨¡æ“¬ç„¡æ³•å¾—çŸ¥è€ƒå€æ’

        updateVisuals(newTotal, g, ["æœ€æ–°æˆ°åŠ›å·²åˆ†æå®Œæˆï¼","é€™æ˜¯æ ¹æ“šä½ æœ€æ–°ä¸€æ¬¡è€ƒè©¦æˆç¸¾æ‰€æ›´æ–°çš„æ•¸æ“šã€‚","è«‹åƒè€ƒé›·é”åœ–çš„è®ŠåŒ–ï¼Œç¢ºèªç›®å‰å¼±é …æ˜¯å¦æ”¹å–„ã€‚","ç¹¼çºŒæœç›®æ¨™å‰é€²ï¼Œè‹±é›„ï¼"]);
        alert("æœ€æ–°æˆ°åŠ›åˆ†ææˆåŠŸï¼å·²æ›´æ–°æ•¸æ“šçœ‹æ¿ã€‚");
    }

    function renderChart(g) {
        const m = {"A++":100,"A+":90,"A":80,"B++":65,"B+":55,"B":45,"C":20};
        const ctx = document.getElementById('radarChart').getContext('2d');
        if(window.myChart) window.myChart.destroy();
        window.myChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['åœ‹', 'è‹±', 'æ•¸', 'è‡ª', 'ç¤¾'],
                datasets: [{ 
                    data: [m[g.ch], m[g.en], m[g.ma], m[g.sc], m[g.so]],
                    backgroundColor: 'rgba(34, 211, 238, 0.2)',
                    borderColor: '#e0f2fe', 
                    borderWidth: 4,         
                    pointBackgroundColor: '#fff'
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: { color: 'rgba(255, 255, 255, 0.3)', lineWidth: 2 }, 
                        grid: { color: 'rgba(255, 255, 255, 0.3)', lineWidth: 2 },       
                        pointLabels: { color: '#f8fafc', font: { size: 14, weight: 'bold' } },
                        suggestedMin: 0, suggestedMax: 100,
                        ticks: { display: false }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    function openPwdModal() { document.getElementById('overlay').style.display='block'; document.getElementById('pwdModal').style.display='block'; }
    function closePwdModal() { document.getElementById('overlay').style.display='none'; document.getElementById('pwdModal').style.display='none'; }
    function submitNewPwd() {
        const id = document.getElementById('userSelect').value;
        const old = document.getElementById('oldPwd').value;
        const nPass = document.getElementById('newPwd').value;
        if(!id) return alert("è«‹é¸æ“‡å§“å");
        const saved = localStorage.getItem('pwd_'+id) || "308"+(id < 10 ? '0'+id : id);
        if(old === saved && nPass.length >= 4) {
            localStorage.setItem('pwd_'+id, nPass);
            alert("ä¿®æ”¹æˆåŠŸï¼");
            closePwdModal();
        } else alert("é©—è­‰å¤±æ•—æˆ–å¯†ç¢¼å¤ªçŸ­");
    }
</script>
</body>
</html>